import asyncio
import websockets

async def listen_websocket(url):
    """Устанавливаем коннект с вебсокетом """

    async with websockets.connect(url, open_timeout=30) as ws:
        listener_task = asyncio.create_task(receive_messages(ws))
        ping_task = asyncio.create_task(send_periodic_ping(ws, interval=10))

        await asyncio.sleep(60)  # слушаем 180 секунд

        listener_task.cancel()
        ping_task.cancel()

        try:
            await listener_task
        except asyncio.CancelledError:
            print("WebSocket соединение закрыто по таймерdsadasdasdaу")

        try:
            await ping_task
        except asyncio.CancelledError:
            pass

async def send_periodic_ping(ws, interval):
    """Отправляем Ping на сервер"""

    while True:
        await ws.ping()
        print("Ping отправлен")
        await asyncio.sleep(interval)

async def receive_messages(ws):
    """Выводим сообщения, которые пришли"""

    async for message in ws:
        print("Сообщение:", message)
